---
title: "WykÅ‚ad 2"
subtitle: "SygnaÅ‚y zegarowe"
---

{{< part "UkÅ‚ady asynchroniczne i&nbsp;synchroniczne" >}}

{{< slide "UkÅ‚ady asynchroniczne" />}}
{{< img-slide asynchronous.png />}}
{{< ul-slide "UkÅ‚ady asynchroniczne" >}}
	{{< lf >}}szybkie
	{{< lf >}}energooszczÄ™dne
	{{< lf >}}trudne w projektowaniu
{{< /ul-slide >}}

{{< slide "UkÅ‚ady synchroniczne" />}}
{{< img-slide synchronous.png />}}
{{< ul-slide "UkÅ‚ady synchroniczne" >}}
	{{< lf >}}wolniejsze
	{{< lf >}}zuÅ¼ywajÄ… energiÄ™ caÅ‚y czas
	{{< lf >}}Å‚atwiejsze do zaprojektowania
{{< /ul-slide >}}

{{< ul-slide "Pierwszy asynchroniczny mikroprocesor" >}}
	{{< note >}}To pierwszy asynchroniczny <strong>mikroprocesor</strong>. Procesory asynchroniczne powstawaÅ‚y wczeÅ›niej, np. MERA-400 zaprojektowana przez ElÅ¼bietÄ™ JezierskÄ…-Ziemkiewicz.{{< /note >}}
	{{< lf >}}California Institute of Technology, Pasadena, 1988â€“1989
	{{< lf >}}samoistnie dostosowuje szybkoÅ›Ä‡ do temperatury
	{{< lf >}}samoistnie dostosowuje szybkoÅ›Ä‡ do napiÄ™cia zasilania
	{{< lf >}}4Ã— mniej energii niÅ¼ synchroniczny odpowiednik przy tej samej wydajnoÅ›ci
{{< /ul-slide >}}

{{< img-slide potato.webp "Zasilanie bulwÄ…" />}}

{{< ul-slide "Intel RAPPID" >}}
	{{< lf >}}<em>Revolving Asynchronous PentiumÂ® Processor Instruction Decoder</em>
	{{< lf >}}1995â€“1999
	{{< lf >}}3Ã— szybszy
	{{< lf >}}2Ã— mniejsze zuÅ¼ycie energii
	{{< lf >}}<strong>5Ã— dÅ‚uÅ¼szy czas projektowania</strong> ğŸ’µğŸ’°ğŸ¤‘
	{{< lf >}}<strong>trudne testowanie</strong>
	{{< lf >}}pewne koncepcje wykorzystane w&nbsp;Pentium&nbsp;4
{{< /ul-slide >}}

{{< ul-slide "Programowanie asynchroniczne <sup>â•</sup>" >}}
	{{< lf >}}nie ma zwiÄ…zku z ukÅ‚adami asynchronicznymi
	{{< lf >}}pozwala obsÅ‚ugiwaÄ‡ wiele zdarzeÅ„ o stosunkowo dÅ‚ugim czasie wykonania bez blokowania programu
{{< /ul-slide >}}

{{< part "Å¹rÃ³dÅ‚a zegarowe" >}}

{{< slide "Oscylator RC" />}}
{{< img-slide pic16f5x-rc-oscillator.png />}}
{{< ul-slide "Oscylator RC" >}}
	{{< lf >}}tani
	{{< lf >}}maÅ‚y (moÅ¼liwy do wbudowania w ukÅ‚ad scalony)
	{{< lf >}}energooszczÄ™dny
	{{< lf >}}niedokÅ‚adny
{{< /ul-slide >}}

{{< img-slide atmega32-block-diagram.webp />}}

{{< ul-slide "Rezonator kwarcowy (XO/XTAL)" >}}
	{{< lf >}}droÅ¼szy
	{{< lf >}}wiÄ™kszy
	{{< lf >}}zuÅ¼ywa wiÄ™cej energii
	{{< lf >}}bardzo dokÅ‚adny (zwÅ‚aszcza VCXO, TCXO i OCXO)
{{< /ul-slide >}}
{{< ul-slide "Rezonatory kwarcowe" >}}
	<dl>
		<dt class="fragment" data-fragment-index="1">VCXO
			<dd class="fragment" data-fragment-index="1">Voltage-Controlled Crystal Oscillator
		<dt class="fragment" data-fragment-index="2">TCXO
			<dd class="fragment" data-fragment-index="2">Temperature-Compensated Crystal Oscillator
		<dt class="fragment" data-fragment-index="3">OCXO
			<dd class="fragment" data-fragment-index="3">Oven-Controlled Crystal Oscillator
	</dl>
{{< /ul-slide >}}
{{< img-slide quartz-crystal-internal.jpg />}}
{{< img-slide ocxo.gif />}}

{{< ul-slide "Wzorzec rubidowy" >}}
	{{< lf >}}nieludzko dokÅ‚adny
	{{< lf >}}bardzo drogi
	{{< lf >}}zuÅ¼ywa duÅ¼o energii
{{< /ul-slide >}}
{{< img-slide rubidium.webp />}}

{{< ul-slide "Odbiornik GNSS (np. GPS) â€” <em>1PPS</em>" >}}
	{{< lf >}}bardzo dokÅ‚adny
	{{< lf >}}stosunkowo tani
	{{< lf >}}ma Å›rednie zapotrzebowanie na energiÄ™
	{{< lf >}}dostarcza rÃ³wnieÅ¼ czas rzeczywisty
	{{< lf >}}wymaga sygnaÅ‚u z satelity
{{< /ul-slide >}}
{{< img-slide gps.jpg />}}

{{< slide "PrzykÅ‚adowe dokÅ‚adnoÅ›ci wzorcÃ³w czasu" >}}
	{{< table "Å¹rÃ³dÅ‚o" "DokÅ‚adnoÅ›Ä‡" "OdchyÅ‚ka" >}}
		{{< row-right "RC" "Â±1%" "7h/miesiÄ…c" >}}
		{{< row-right "XO" "Â±20ppm" "51s/miesiÄ…c" >}}
		{{< row-right "OCXO" "Â±100ppb" "3s/rok" >}}
		{{< row-right "Rb" "Â±1,5ppb" "47ms/rok" >}}
	{{< /table >}}
{{< /slide >}}

{{< part "Regulacja szybkoÅ›ci zegara" >}}

{{< ul-slide "Szybki zegar \(\Rightarrow\) problem" >}}
	{{< lf >}}duÅ¼e zuÅ¼ycie energii
	{{< lf >}}wydzielanie ciepÅ‚a
	{{< lf >}}wyÅ¼sze napiÄ™cie zasilania
	{{< lf >}}generowanie zakÅ‚Ã³ceÅ„
	{{< lf >}}zjawiska falowe
	{{< lf >}}czas propagacji
{{< /ul-slide >}}
{{< img-slide mega-active.webp />}}
{{< img-slide mega-idle.webp />}}

{{< ul-slide "Dzielnik czÄ™stotliwoÅ›ci â€” <em>divider</em>" >}}
	{{< lf >}}najproÅ›ciej podzieliÄ‡ czÄ™stotliwoÅ›Ä‡ przez $2^n$
	{{< lf >}}moÅ¼liwe jest uzyskanie podziaÅ‚u takÅ¼e przez $n$
	{{< lf >}}nie ma moÅ¼liwoÅ›ci zwiÄ™kszenia czÄ™stotliwoÅ›ci
	{{< lf >}}wymaga zewnÄ™trznego ÅºrÃ³dÅ‚a zegara
{{< /ul-slide >}}
{{< img-slide bincount.png />}}
{{< img-slide counter.svg false "background-color: white"/>}}

{{< ul-slide "VCO" />}}
{{< img-slide korg.webp />}}
{{< ul-slide "VCO â€” <em>Voltage-Controlled Oscillator</em>" >}}
	{{< lf >}}sterowany napiÄ™ciem generator RC
	{{< lf >}}jest ÅºrÃ³dÅ‚em zegara, ale o niskiej dokÅ‚adnoÅ›ci
{{< /ul-slide >}}
{{< img-slide vco-plot.gif />}}

{{< ul-slide "PLL â€” <em>Phase-Locked Loop</em>" />}}
{{< img-slide basic-pll.png />}}
{{< ul-slide "Zalety PLL" >}}
	{{< lf >}}mnoÅ¼y czÄ™stotliwoÅ›Ä‡ wzorcowÄ… przez $n$
	{{< lf >}}w poÅ‚Ä…czeniu z dzielnikiem przez $m$ pozwala uzyskaÄ‡ wspÃ³Å‚czynnik $\frac{n}{m}$
	{{< lf >}}bardzo elastyczne rozwiÄ…zanie â€” <em>must-have</em> dla nowoczesnego mikrokontrolera
{{< /ul-slide >}}
{{< ul-slide "Wady PLL" >}}
	{{< lf >}}skomplikowany obwÃ³d analogowo-cyfrowy
	{{< lf >}}czÄ™sto stabilnoÅ›Ä‡ uzyskuje tylko w pewnym zakresie czÄ™stotliwoÅ›ci wejÅ›ciowej
	{{< lf >}}uzyskanie stabilnoÅ›ci zajmuje pewien czas i moÅ¼e byÄ‡ sygnalizowane w odpowiednim rejestrze
{{< /ul-slide >}}

{{< part "Kondycjonowanie i propagacja sygnaÅ‚u zegarowego" >}}

{{< slide "Podsystem zegarowy mikrokontrolera" />}}
{{< img-slide xmega-clock-system.webp />}}
{{< img-slide omap-pll.webp />}}
{{< img-slide omap-pll-table.webp />}}
{{< slide >}}
	{{< code lines="1|8-22|64-68|32-42" >}}
		int davinci_set_sysclk_rate(struct clk *clk, unsigned long rate)
		{
			unsigned v;
			struct pll_data *pll;
			unsigned long input;
			unsigned ratio = 0;

			/* If this is the PLL base clock, wrong function to call */
			if (clk->pll_data)
				return -EINVAL;

			/* There must be a parent... */
			if (WARN_ON(!clk->parent))
				return -EINVAL;

			/* ... the parent must be a PLL... */
			if (WARN_ON(!clk->parent->pll_data))
				return -EINVAL;

			/* ... and this clock must have a divider. */
			if (WARN_ON(!clk->div_reg))
				return -EINVAL;

			pll = clk->parent->pll_data;

			input = clk->parent->rate;

			/* If pre-PLL, source clock is before the multiplier and divider(s) */
			if (clk->flags & PRE_PLL)
				input = pll->input_rate;

			if (input > rate) {
				/*
				 * Can afford to provide an output little higher than requested
				 * only if maximum rate supported by hardware on this sysclk
				 * is known.
				 */
				if (clk->maxrate) {
					ratio = DIV_ROUND_CLOSEST(input, rate);
					if (input / ratio > clk->maxrate)
						ratio = 0;
				}

				if (ratio == 0)
					ratio = DIV_ROUND_UP(input, rate);

				ratio--;
			}

			if (ratio > pll->div_ratio_mask)
				return -EINVAL;

			do {
				v = __raw_readl(pll->base + PLLSTAT);
			} while (v & PLLSTAT_GOSTAT);

			v = __raw_readl(pll->base + clk->div_reg);
			v &= ~pll->div_ratio_mask;
			v |= ratio | PLLDIV_EN;
			__raw_writel(v, pll->base + clk->div_reg);

			v = __raw_readl(pll->base + PLLCMD);
			v |= PLLCMD_GOSET;
			__raw_writel(v, pll->base + PLLCMD);

			do {
				v = __raw_readl(pll->base + PLLSTAT);
			} while (v & PLLSTAT_GOSTAT);

			return 0;
		}
	{{< /code >}}
{{< /slide >}}

{{< slide "Propagacja zegara w systemie" />}}
{{< img-slide mc14521b.webp />}}
{{< img-slide clk.png />}}
{{< img-slide cdcv304.webp />}}
{{< img-slide square-traces-featured.webp />}}

{{< slide "DÅ‚ugoÅ›Ä‡ fali" >}}
	<div class="r-stack">
		<div class="fragment fade-in-then-out">\(\lambda = \frac{v}{f}\)</div>
		<div class="fragment fade-in-then-out">\(\lambda = \frac{v}{f} = \frac{3\cdot10^{8}\frac{\text{m}}{\text{s}}}{10\text{GHz}}\)</div>
		<div class="fragment fade-in-then-out">\(\lambda = \frac{v}{f} = \frac{3\cdot10^{8}\frac{\text{m}}{\text{s}}}{10\text{GHz}} = \frac{3\cdot10^{11}\frac{\text{mm}}{\text{s}}}{10\cdot10^9\frac{1}{\text{s}}}\)</div>
		<div class="fragment">\(\lambda = \frac{v}{f} = \frac{3\cdot10^{8}\frac{\text{m}}{\text{s}}}{10\text{GHz}} = \frac{3\cdot10^{11}\frac{\text{mm}}{\text{s}}}{10\cdot10^9\frac{1}{\text{s}}} = 30\text{mm}\)</div>
	</div>
{{< /slide >}}

{{< part "Zegary czasu rzeczywistego" >}}

{{< ul-slide "Przeznaczenie czasu rzeczywistego" >}}
	{{< lf >}}wyÅ›wietlanie czasu uÅ¼ytkownikowi
	{{< lf >}}logowanie zdarzeÅ„
	{{< lf >}}wykonywanie zaplanowanych zadaÅ„
	{{< lf >}}komunikacja z innymi urzÄ…dzeniami (np. TDMA)
	{{< lf >}}licencjonowanie funkcjonalnoÅ›ci
{{< /ul-slide >}}

{{< ul-slide "Dostarczenie czasu rzeczywistego" >}}
	{{< lf >}}liczenie czasu w programie
	{{< lf >}}RTC zintegrowany w mikrokontrolerze
	{{< lf >}}RTC zewnÄ™trzny
	{{< lf >}}odbiornik GNSS (np. GPS)
	{{< lf >}}NTP (<em>Network Time Protocol</em>)
	{{< lf >}}DCF77 (50kW@77,5kHz â€” 2000km)
	{{< lf >}}GSM
	{{< lf >}}RDS (<em>Radio Data System</em>) â€” Â±100ms
	{{< lf >}}Bluetooth (sparowany telefon komÃ³rkowy)
{{< /ul-slide >}}
{{< img-slide omap-rtc.webp />}}
{{< img-slide ds3231.webp />}}
{{< img-slide dcf.webp />}}
{{< img-slide waveceptor.jpg />}}

{{< slide "CzÄ™stotliwoÅ›Ä‡ oscylatora" >}}
	<div class="fragment">Dlaczego \(f = 32{,}768\text{kHz}\)?</div>
	<div class="r-stack">
		<div class="fragment fade-in-then-out">\(t = \frac{32{,}768\text{kHz}}{2^{n}}\)</div>
		<div class="fragment fade-in-then-out">\(t = \frac{32{,}768\text{kHz}}{2^{15}}\)</div>
		<div class="fragment">\(t = \frac{32{,}768\text{kHz}}{2^{15}} = 1\text{s}\)</div>
	</div>
{{< /slide >}}

