---
title: "Wykad 5"
subtitle: "Kod 藕r贸dowy i kod maszynowy"
---

{{< part "Budowa programu" >}}

{{< slide-animate "Funkcja <code>main</code>" >}}
	{{< code lang="cpp" lines="1-2" >}}
		int main() {
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "Inicjalizacja" >}}
	{{< code lang="cpp" lines="1-3,6" >}}
		void gpioInit() {
			// Inicjalizacja GPIO
		}

		int main() {
			gpioInit();
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "Nieskoczona ptla" >}}
	{{< code lang="cpp" lines="7-8" >}}
		void gpioInit() {
			// Inicjalizacja GPIO
		}

		int main() {
			gpioInit();
			while (true) {
			}
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "Funkcja g贸wna" >}}
	{{< code lang="cpp" lines="5-7,13" >}}
		void gpioInit() {
			// Inicjalizacja GPIO
		}

		void ledBlink() {
			// Mruganie diod
		}

		int main()
		{
			gpioInit();
			while (true) {
				ledBlink();
			}
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "Obsuga przerwa" >}}
	{{< code lang="cpp" lines="9-11" >}}
		void gpioInit() {
			// Inicjalizacja GPIO
		}

		void ledBlink() {
			// Mruganie diod
		}

		ISR(TIMER0_OVF_vect) {
			// Obsuga timera
		}

		int main()
		{
			gpioInit();
			while (true) {
				ledBlink();
			}
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "Komunikacja przerwa z ptl g贸wn" >}}
	{{< code lang="cpp" lines="5,9-12,16" >}}
		void gpioInit() {
			// Inicjalizacja GPIO
		}

		volatile bool timerFlag;

		void ledBlink() {
			// Mruganie diod
			if (timerFlag) {
				// Reakcja na upyw czasu
				timerFlag = false;
			}
		}

		ISR(TIMER0_OVF_vect) {
			timerFlag = true;
		}

		int main()
		{
			gpioInit();
			while (true) {
				ledBlink();
			}
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< part "Proces kompilacji i linkowania" >}}
{{< img-slide compiling.webp />}}

{{< part "Pliki nag贸wkowe" >}}

{{< slide "Deklaracja i definicja funkcji" >}}
	{{<	fragment "foo.h (deklaracja z dokumentacj)" >}}
		{{< code lang="cpp" lines="1-6" >}}
			/** Robi co wa偶nego.
			 *  @param argument Liczba wejciowa.
			 *  @return Kod bdu. */
			int foo(int argument);
		{{< /code >}}
	{{< /fragment >}}
	{{<	fragment "foo.c (definicja)" >}}
		{{< code lang="cpp" lines="1,3,5" >}}
			#include "foo.h"

			int foo(int argument) {
				// Bardzo mdra funkcja
			}
		{{< /code >}}
	{{< /fragment >}}
	{{<	fragment "bar.c (wywoanie)" >}}
		{{< code lang="cpp" lines="1,4" >}}
			#include "foo.h"

			void bar() {
				int result = foo(42);
			}
		{{< /code >}}
	{{< /fragment >}}
{{< /slide >}}

{{< slide "Deklaracja i definicja zmiennej" >}}
	{{<	fragment "foo.h (deklaracja z dokumentacj)" >}}
		{{< code lang="cpp" lines="1" >}}
			int foo; ///< Licznik dziwnych zdarze.
		{{< /code >}}
	{{< /fragment >}}
	{{<	fragment "foo.c (definicja)" >}}
		{{< code lang="cpp" lines="1,3,5" >}}
			#include "foo.h"

			int foo = 42;
		{{< /code >}}
	{{< /fragment >}}
	{{<	fragment "bar.c (wywoanie)" >}}
		{{< code lang="cpp" lines="1,4" >}}
			#include "foo.h"

			void bar() {
				printf("%d\n", foo);
			}
		{{< /code >}}
	{{< /fragment >}}
{{< /slide >}}

{{< part "Kod maszynowy" >}}

{{< img-slide avr-gcc-1.webp >}}
	{{< note >}}<code>rcall</code> to trik w celu zarezerwowania jednym rozkazem dw贸ch bajt贸w na stosie.{{< /note >}}
	{{< note >}}<code>r28:r29</code> to rejestr <code>Y</code>.{{< /note >}}
	{{< note >}}<code>r18r27, r30, r31</code> nie musz by odkadane na stosie, bo kompilator zakada, 偶e (poza przerwaniami) bdzie ich u偶ywa tak, 偶e nie ma takiej potrzeby.{{< /note >}}
{{< /img-slide >}}
{{< img-slide avr-gcc-2.webp />}}
{{< img-slide avr-gcc-3.webp />}}
{{< img-slide avr-gcc-4.webp />}}
{{< img-slide avr-gcc-5.webp />}}

{{< part "Sekcje pamici" >}}
{{< img-slide c-code-gen.webp />}}

{{< part "Zarzdzanie pamici" >}}

{{< ul-slide "Dane statyczne" >}}
	{{< lf >}}stae, zmienne globalne i statyczne (<code>static</code>)
	{{< lf >}}deterministyczne
	{{< lf >}}praktycznie natychmiastowe
	{{< lf >}}bardzo bezpieczne (<em>safety-critical</em>) 
{{< /ul-slide >}}

{{< ul-slide "Stos" >}}
	{{< lf >}}deterministyczny
	{{< lf >}}szybki
	{{< lf >}}wspierany sprztowo
	{{< lf >}}mo偶liwo przepenienia np. przez rekurencj く
	{{< lf >}}zazwyczaj mae dane
	{{< lf >}}dane lokalne
	{{< lf >}}dane dostpne przez czas 偶ycia funkcji
{{< /ul-slide >}}

{{< ul-slide "Sterta" >}}
	{{< lf >}}niedeterministyczna
	{{< lf >}}realizacja programowa
	{{< lf >}}fragmentacja
	{{< lf >}}dane dostpne przez nieograniczony czas
	{{< lf >}}wycieki pamici
	{{< lf >}}obsuga przez wska藕niki
	{{< lf >}}C: <code>malloc()</code>, <code>free()</code>
	{{< lf >}}C++: <del><code>new</code></del>, <del><code>delete</code></del>,
		<code>unique_ptr&lt;T&gt;</code>, <code>shared_ptr&lt;T&gt;</code>
{{< /ul-slide >}}

{{< part "Wektor przerwa" >}}

{{< part "Wska藕niki na zmienne i funkcje" >}}

