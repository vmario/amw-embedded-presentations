---
title: "WykÅ‚ad 8"
subtitle: "Obliczenia i optymalizacje"
---

{{< part "Operacje staÅ‚oprzecinkowe" >}}

{{< slide-animate "Zakresy rejestrÃ³w" >}}
	<div class="horizontal-chart">
		<div><div data-id="1b" style="width: calc(100% * pow(2, 1) / pow(2,1))">2</div></div>
		<div data-id="1l">1 bit</div>
	</div>
{{< /slide-animate >}}

{{< slide-animate "Zakresy rejestrÃ³w" >}}
	<div class="horizontal-chart">
		<div><div data-id="1b" style="width: calc(100% * pow(2, 1) / pow(2, 8))">2</div></div>
		<div data-id="1l">1 bit</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="2b" style="width: calc(100% * pow(2, 8) / pow(2, 8))">256</div></div>
		<div data-id="2l">8 bitÃ³w</div>
	</div>
{{< /slide-animate >}}

{{< slide-animate "Zakresy rejestrÃ³w" >}}
	<div class="horizontal-chart">
		<div><div data-id="1b" style="width: calc(100% * pow(2, 1) / pow(2, 16))">2</div></div>
		<div data-id="1l">1 bit</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="2b" style="width: calc(100% * pow(2, 8) / pow(2, 16))">256</div></div>
		<div data-id="2l">8 bitÃ³w</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="3b" style="width: calc(100% * pow(2, 16) / pow(2, 16))">65&nbsp;536</div></div>
		<div data-id="3l">16 bitÃ³w</div>
	</div>
{{< /slide-animate >}}

{{< slide-animate "Zakresy rejestrÃ³w" >}}
	<div class="horizontal-chart">
		<div><div data-id="1b" style="width: calc(100% * pow(2, 1) / pow(2, 32))">2</div></div>
		<div data-id="1l">1 bit</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="2b" style="width: calc(100% * pow(2, 8) / pow(2, 32))">256</div></div>
		<div data-id="2l">8 bitÃ³w</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="3b" style="width: calc(100% * pow(2, 16) / pow(2, 32))">65&nbsp;536</div></div>
		<div data-id="3l">16 bitÃ³w</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="4b" style="width: calc(100% * pow(2, 32) / pow(2, 32))">4&nbsp;294&nbsp;967&nbsp;296</div></div>
		<div data-id="4l">32 bitÃ³w</div>
	</div>
{{< /slide-animate >}}

{{< slide-animate "Zakresy rejestrÃ³w" >}}
	<div class="horizontal-chart">
		<div><div data-id="1b" style="width: calc(100% * pow(2, 1) / pow(2, 64))">2</div></div>
		<div data-id="1l">1 bit</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="2b" style="width: calc(100% * pow(2, 8) / pow(2, 64))">256</div></div>
		<div data-id="2l">8 bitÃ³w</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="3b" style="width: calc(100% * pow(2, 16) / pow(2, 64))">65&nbsp;536</div></div>
		<div data-id="3l">16 bitÃ³w</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="4b" style="width: calc(100% * pow(2, 32) / pow(2, 64))">4&nbsp;294&nbsp;967&nbsp;296</div></div>
		<div data-id="4l">32 bitÃ³w</div>
	</div>
	<div class="horizontal-chart">
		<div><div data-id="5b" style="width: calc(100% * pow(2, 64) / pow(2, 64))">18&nbsp;446&nbsp;744&nbsp;073&nbsp;709&nbsp;551&nbsp;616</div></div>
		<div data-id="5l">64 bity</div>
	</div>
{{< /slide-animate >}}

{{< img-slide "int-c++.webp" "Typy w C i C++" />}}
{{< img-slide int-rust.webp "Typy w Rust" />}}
{{< img-slide "int-c++-std.webp" "Typy o ustalonej szerokoÅ›ci w C i C++" />}}

{{< img-slide "int.svg" "Typy o ustalonej szerokoÅ›ci w C i C++" />}}

{{< ul-slide "Kod U2 (<em>two's complement</em>)" >}}
	{{< lf >}}aby zamieniÄ‡ liczbÄ™ na przeciwnÄ…, naleÅ¼y zanegowaÄ‡ bity i dodaÄ‡ 1
	{{< lf >}}jest tylko jedno zero
	{{< lf >}}operacje na liczbach ujemnych nie wymagajÄ… specjalnego traktowania
	{{< lf >}}wynik operacji automatycznie jest poprawnÄ… wartoÅ›ciÄ… U2
{{< /ul-slide >}}

{{< part "Operacje zmiennoprzecinkowe" >}}

{{< img-slide "float.svg" "PrzykÅ‚ady typÃ³w zmiennoprzecinkowych" />}}

{{< slide-animate "Cyfry znaczÄ…ce" >}}
	{{< code lang="cpp" lines="1-5,8|10-12|14-16|18-20|22-24|26-28|30-32" >}}
		#include &lt;cstdio&gt;
		#include &lt;cinttypes&gt;
		#include &lt;iostream&gt;
		#include &lt;iomanip&gt;
		using namespace std;

		int main() {
			cout << setprecision(40);

			uint64_t foo = UINT64_C(12345678901234567890);
			cout << foo << endl;
			// ğŸ  12345678901234567890

			double foo_double = foo;
			cout << foo_double << endl;
			// ğŸ  12345678901234567168

			float foo_float{foo};
			cout << foo_float << endl;
			// ğŸ  12345679395506094080
			
			double bar_huge = 1234567890e100;
			cout << bar_huge << endl;
			// ğŸ  1.234567890000000078944836269502040274001e+109

			double bar_tiny = 1234567890e-100;
			cout << bar_tiny << endl;
			// ğŸ  1.2345678900000001211954157757914595974e-91

			double bar_inf = 1234567890e300;
			cout << bar_inf << endl;
			// ğŸ  inf
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "BÅ‚Ä…d zaokrÄ…glania" >}}
	{{< code lang="cpp" lines="10-14" >}}
		#include &lt;cstdio&gt;
		#include &lt;cinttypes&gt;
		#include &lt;iostream&gt;
		#include &lt;iomanip&gt;
		using namespace std;

		int main() {
			cout << setprecision(40);

			double foo = 0.1 + 0.1 + 0.1 + 0.1 + 0.1 
					+ 0.1 + 0.1 + 0.1 + 0.1 + 0.1;
			uint64_t foo_int = foo;
			cout << foo_int << endl;
			// ğŸ  0
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "BÅ‚Ä…d zaokrÄ…glania" >}}
	{{< code lang="cpp" lines="10-14|16-20|22-26" >}}
		#include &lt;cstdio&gt;
		#include &lt;cinttypes&gt;
		#include &lt;iostream&gt;
		#include &lt;iomanip&gt;
		using namespace std;

		int main() {
			cout << setprecision(40);

			cout << 0.1 << endl;
			// ğŸ  0.1000000000000000055511151231257827021182
			cout << 0.1 + 0.1 + 0.1 + 0.1 + 0.1
					+ 0.1 + 0.1 + 0.1 + 0.1 + 0.1 << endl;
			// ğŸ  0.9999999999999998889776975374843459576368
			
			cout << 0.1f << endl;
			// ğŸ  0.100000001490116119384765625
			cout << 0.1f + 0.1f + 0.1f + 0.1f + 0.1f
					+ 0.1f + 0.1f + 0.1f + 0.1f + 0.1f << endl;
			// ğŸ  1.00000011920928955078125

			cout << 0.5 << endl;
			// ğŸ  0.5
			cout << 0.5 + 0.5 + 0.5 + 0.5 + 0.5
					+ 0.5 + 0.5 + 0.5 + 0.5 + 0.5 << endl;
			// ğŸ  5
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "PorÃ³wnywanie wartoÅ›ci zmiennoprzecinkowych" >}}
	{{< code lang="cpp" lines="10-13|15-17|19-24|26-32" >}}
		#include &lt;cstdio&gt;
		#include &lt;cinttypes&gt;
		#include &lt;iostream&gt;
		#include &lt;iomanip&gt;
		using namespace std;

		int main() {
			cout << setprecision(40);

			double sum = 0.1 + 0.1 + 0.1 + 0.1 + 0.1
					+ 0.1 + 0.1 + 0.1 + 0.1 + 0.1;
			cout << sum << endl;
			// ğŸ  0.9999999999999998889776975374843459576368

			double multiplication = 0.1 * 10;
			cout << multiplication << endl;
			// ğŸ  1
		 
			if (sum == multiplication) {
				cout << "OK" << endl;
			} else {
				cout << "Error" << endl;
			}
			// ğŸ  Error
		 
			constexpr double EPSILON = 1.0 / 1000;
			if (abs(sum - multiplication) < EPSILON) {
				cout << "OK" << endl;
			} else {
				cout << "Error" << endl;
			}
			// ğŸ  OK
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< part "DomyÅ›lne typy podczas obliczeÅ„" >}}

{{< slide-animate "DomyÅ›lny typ staÅ‚oprzecinkowy" >}}
	{{< code lang="cpp" lines="6-7,9-10,12-13" >}}
		#include &lt;cinttypes&gt;
		#include &lt;iostream&gt;
		using namespace std;

		int main() {
			cout << 123'456'789 * 10 << endl;
			// ğŸ  1234567890

			cout << 1'123'456'789 * 10 << endl;
			// ğŸ  -1650333998 ğŸ¤¨

			cout << 11'123'456'789 * 10 << endl;
			// ğŸ  111234567890
		}
	{{< /code >}}
	<div class="fragment">
	{{< code lang="plain" >}}
		foo.cpp: In function â€˜int main()â€™:
		foo.cpp:9:31: warning: integer overflow in expression
		of type â€˜intâ€™ results in â€˜-1650333998â€™ [-Woverflow]
			9 |         cout &lt;&lt; 1'123'456'789 * 10 << endl;
			  |                 ~~~~~~~~~~~~~~^~~~
	{{< /code >}}
	</div>
{{< /slide-animate >}}

{{< slide-animate "DomyÅ›lny typ staÅ‚oprzecinkowy" >}}
	{{< code lang="cpp" lines="6-7|9-10|12-13" >}}
		#include &lt;cinttypes&gt;
		#include &lt;iostream&gt;
		using namespace std;

		int main() {
			cout &lt;&lt; 1'123'456'789ll * 10 &lt;&lt; endl;
			// ğŸ  11234567890

			cout &lt;&lt; 1'123'456'789 * 10ll &lt;&lt; endl;
			// ğŸ  11234567890

			cout &lt;&lt; INT64_C(1'123'456'789) * 10 &lt;&lt; endl;
			// ğŸ  11234567890
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< slide-animate "DomyÅ›lny typ zmiennoprzecinkowy" >}}
	{{< code lang="cpp" lines="7-8|10-12|14-15|17-23" >}}
		#include &lt;cinttypes&gt;
		#include &lt;iostream&gt;
		#include &lt;iomanip&gt;
		using namespace std;

		int main() {
			cout << 1 / 10 << endl;
			// ğŸ  0

			double foo = 1 / 10;
			cout << foo << endl;
			// ğŸ  0

			cout << 1.0 / 10 << endl;
			// ğŸ  0.1

			cout << setprecision(40);

			cout << 1.0 / 10 << endl;
			// ğŸ  0.1000000000000000055511151231257827021182

			cout << 1.0f / 10 << endl;
			// ğŸ  0.100000001490116119384765625
		}
	{{< /code >}}
{{< /slide-animate >}}

{{< part "SposÃ³b przeprowadzania obliczeÅ„" >}}

{{< ul-slide "FPU (<em>Floating-Point Unit</em>)" >}}
	{{< lf >}}emulacja programowa
	{{< lf >}}zewnÄ™trzny koprocesor
	{{< lf >}}wewnÄ™trzny koprocesor
	{{< lf >}}integralna czÄ™Å›Ä‡ ALU
{{< /ul-slide >}}

{{< part "Przetwarzanie potokowe" >}}
{{< part "IEEE-754" >}}
